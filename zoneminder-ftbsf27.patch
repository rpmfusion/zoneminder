From 38ce8dab6184df31b0b20c2ae6a2dc26bc0bc10a Mon Sep 17 00:00:00 2001
From: Andy Bauer <knnniggett@hotmail.com>
Date: Tue, 13 Jun 2017 13:14:37 -0500
Subject: [PATCH] move include <sys/uio.h> outside defined(BSD) block

---
 src/zm_comms.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/zm_comms.h b/src/zm_comms.h
index cf108c1ea..ae5fd5b08 100644
--- a/src/zm_comms.h
+++ b/src/zm_comms.h
@@ -30,9 +30,9 @@
 
 #include <set>
 #include <vector>
+#include <sys/uio.h>
 
 #if defined(BSD)
-#include <sys/uio.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
 #endif

---
From 97380f009b0e6a8bb6ee4ecbf0436045342cdf1e Mon Sep 17 00:00:00 2001
From: abishai <abi@abinet.ru>
Date: Tue, 31 Jan 2017 10:42:57 +0300
Subject: [PATCH] implement platform-agnostic comparison without abs()

---
 src/zm_image.cpp | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/src/zm_image.cpp b/src/zm_image.cpp
index 9c8c12fda..80a821376 100644
--- a/src/zm_image.cpp
+++ b/src/zm_image.cpp
@@ -1658,11 +1658,9 @@ Image *Image::Highlight( unsigned int n_images, Image *images[], const Rgb thres
       {
         uint8_t *psrc = images[j]->buffer+c;
 
-#ifndef SOLARIS
-        if ( (unsigned)abs((*psrc)-RGB_VAL(ref_colour,c)) >= RGB_VAL(threshold,c) )
-#else
-        if ( (unsigned)std::abs((*psrc)-RGB_VAL(ref_colour,c)) >= RGB_VAL(threshold,c) )
-#endif
+	    unsigned int diff = ((*psrc)-RGB_VAL(ref_colour,c)) > 0 ? (*psrc)-RGB_VAL(ref_colour,c) : RGB_VAL(ref_colour,c) - (*psrc);
+
+	    if (diff >= RGB_VAL(threshold,c))
         {
           count++;
         }
